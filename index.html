<!DOCTYPE html>
<html>
<head>
	<!-- Recommended meta tags -->
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0">
	<!-- PyScript CSS -->
	<link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css">
	<!-- This script tag bootstraps PyScript -->
	<script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
</head>
   
<body>
	<py-config>
      packages = ["pandas", "matplotlib"]
	</py-config>
	
<div class="row overflow-hidden" id="content">
    <div class="col mh-100 float-left" id="main">
        <div id="fileinput"></div>
        <input type="file" name="upload" id="upload">
    </div>
</div>

<div id="graph"></div>

<py-script>
from js import document
from io import BytesIO
import pandas as pd
import matplotlib.pyplot as plt
import sys
import numpy as np
from pyscript import display
from pyscript import when

@when('change', 'upload')
	
async def processFile(*args):
	csv_file = document.getElementById('upload').files.item(0)
	
	array_buf = await csv_file.arrayBuffer() # Get arrayBuffer from file
	file_bytes = array_buf.to_bytes() # convert to raw bytes array 
	csv_file = BytesIO(file_bytes) # Wrap in Python BytesIO file-like object
	
	# Read the CSV file into a Pandas DataFrame
	df = pd.read_csv(csv_file)
	#df = pd.read_csv(csv_file,
	#				 names=['Frequency', 'Signal'])
	#plot()
	#df.plot(kind = 'scatter', x = 'Frequency', y = 'Signal')
	#plt.show()

	#plt.savefig(sys.stdout.buffer)
	#sys.stdout.flush()
	
	dataArray = df.to_numpy()
		
	fig1, ax1 = plt.subplots(1, figsize=(6,4))
	x = dataArray[:,0]
	y = dataArray[:,1]
	fig1 = ax1.scatter(x, y)
	plt.title("Signal vs. Frequency", fontsize=6)
	plt.xlabel("Frequency", fontsize=6)  
	plt.ylabel("Signal", fontsize=6)
	plt.show()
	plt.close('all')
	
	display(fig1, target='graph')

</py-script>

</body>
</html>
